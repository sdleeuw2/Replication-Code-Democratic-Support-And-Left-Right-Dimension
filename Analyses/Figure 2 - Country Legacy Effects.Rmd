---
title: "Figure 2 - Country Legacy Effects"
---

Libraries: 
```{r message=FALSE, warning=FALSE, paged.print=FALSE}
lapply(c("mgcv", "gamm4", "rstanarm", "ggpubr", "ggplot2", "plyr", "dplyr"), require, character.only = TRUE)
```

Import Data:
```{r message=FALSE, warning=FALSE, paged.print=FALSE}
source("source_file.R")
```

Bayesian Generalized Additive Mixed Model Based with random effect for left-right orientation:
```{r}
h1_gamm = stan_gamm4(autdem ~ s(lrscale, k = 10), data = df, random = ~ (1 + lrscale | country), 
                     chains = 2, iter = 3500)
```

Predict values DAP based on GAMM model:
```{r}
df_pred = data.frame(
 cbind(subset(df, select = c("lrscale", "autdem", "country", "legacy")),
 predictive_interval(h1_gamm, prob = 0.90, type = "response")))
df_pred$autdem_m = (df_pred$X5. + df_pred$X95.) / 2
```

Aggregated predictions per country and legacy:
```{r}
pred_cntry = aggregate(autdem_m ~ lrscale + country, data = df_pred, FUN = mean)
pred_leg = aggregate(autdem_m ~ lrscale + legacy, data = df_pred, FUN = mean)
sample = df_pred[sample(1:length(df_pred$cntry), 5000),]
```

```{r}
library(ggplot2)
ggplot(pred_cntry, aes(x = lrscale, y = mean, group = cntry)) + ylab("Democratic Support") + 
 geom_rug(position = "jitter", color = "grey40", alpha = 0.5) + 
 geom_smooth(se = FALSE, size = 0.2, color = "grey90", alpha = 0.5) + 
 geom_smooth(data = pred_leg, aes(x = lrscale, y = mean, group = NA), color = "black", size = 0.5) + 
 scale_x_continuous(breaks = seq(1,10,1), labels = c("Left", rep("", 8), "Right")) + 
 ylim(-0.1,2.5) + theme_minimal() + 
 facet_grid(.~ legacy) +
 theme(legend.position = "none", axis.title.x = element_blank(), panel.grid.minor = element_blank(), 
       strip.text = element_text(size = 10))

dev.copy(png,paste0(fig_dir, 'Figure 2 - Country Legacy Effects.png'), width = 2500, height = 1500, res=400)
dev.off()
```


